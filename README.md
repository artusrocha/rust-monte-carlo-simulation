## Business Scenario Description

The necessity is to simulate multiple scenarios to predict the possibilities of losses in the management of a logistics distribution center with with hundreds of thousands of different products(SKU's) in stock.

---

Updates may continually occur that affect simulation inputs, e.g:

- scheduling for product withdrawals from stock
- withdrawal of products from stock, previously scheduled
- scheduling for entry/delivery of new products into stock
- entries/deliveries of new products, previously scheduled

In this case new simulations are needed to update the forecast scenarios.

---

The results of simulations must to show, day by day for the next 90 days, the probability of happen 3 kinds of losses:

- scheduled entries/deliveries that will not have free space in the warehouse
- product(sku) requested to withdraw but missing in the stock
- product(sku) that will achieve the expiration date in the stock

---

### Monte Carlo Simulation Scenarios

> The simulations will not be based only on knowledge about scheduled entries and withdrawals. But also in supply and demand forecasts based on historical data from the last 5 years and random shocks. Forming multiple ***Monte Carlo Simulation*** scenarios.

#### Historical referential data

`HRDE (Entry)`  
`HRDW (Withdraw)`  
Average number of entries and withdrawals of products from stock per day over the last 5 years. To follow the seasonal characteristics of supply and consumption of each product, the average number should be based on the values of the same day of the year on each year of the historic.

#### Trend factor

`TF`  
The trend will be represented by a multiply factor over the historical referential data, e.g (uptrend of 20% will be the multiply factor: 1.2)  
  
The scenarios will be distributed equally across 9 trend categories:

- supply on an uptrend, demand stable
- supply on an uptrend, demand on a downtrend
- supply on an uptrend, demand on an uptrend
- supply on a downtrend, demand stable
- supply on a downtrend, demand on a downtrend
- supply on a downtrend, demand on an uptrend
- stable supply, stable demand
- stable supply, demand on a downtrend
- stable supply, demand on an uptrend

#### Random range factor

`RF`  
A random multiplier factor generated within a configurable range will be applied to the HRD*TF result. This random factor aims to add unpredictable behavior to the model within the real scenario, caused by random fluctuations in the supply and consumption of products.  
For example, for a random fluctuation of 5% plus or minus, a multiplicative factor between 0.95 and 1.05 will be randomly generated for each day of the simulation in the scenario.

#### Scenarios outputs

The output of the generation of a scenario is a ordered list with length equal to the quantity of days that wants to simulate (e.g. for a 90 days simulation, each scenario will be a list of 90 items).  
Each item in the list should have the value of stock entries and withdraws for the day, both values should be greater or equal than zero.  
The quantity of scenarios that should be generated by product should be configurable.  

### Simulation

With generated scenarios and state of current product stock data as inputs, the simulation will be executed.
For each product scenario the simulation should:
Starts setting the current stock value as initial value for day 0.
Following sequentially each day in the scenario, because the simulation of a day affects the product stock state for the next day, both movements (withdraw and entry) must be applied.

The first movement must be the withdraw.
When withdrawing, must go through the list of product batches in stock from the oldest to the most recent and withdraw until the required withdrawal quantity is reached.
If the quantities in the product batches in stock are not sufficient for total withdrawal. A loss of the STOCK_SHORTAGE type with the number of missing items must be recorded in the day's result in this scenario.

Before applying the entry movement, must check if there is space for the new quantity to enter.
If the sum of items in stock added to the quantity of the new entry exceeds the limit quantity set for the product. A loss of type STOCK_LIMIT_EXCEEDED must be recorded in the day's results in this scenario with the number of items that were exceeded. And the exceeded value must be subtracted from the entry value of the day (thus adjusting the input quantity to the limit configured for the product).

After quantity adjustment, the stock entry movement is then applied. This movement is applied by adding a new item with the adjusted entry quantity to the end of the list of batches of the product in stock.

After withdraw and entry movements applied, must do a verification in the remaining batches in the stock. Looking for batches that achieved the limit of time in stock.
The batches that achieved the limit of time in stock, must be removed from stock list. And a loss of type STOCK_TIME_LIMIT_EXCEEDED must be recorded in the day's results in this scenario with the sum of quantities in the batches that achieved the time limit.

### Summarization

The results expected are for each item day by day inform with the probability expressed in % of occurs each type of losses.

### Other Rules

---

## Architecture Definition

- The scope of this implementation is create the scenarios and execute the simulation
- The variable characteristics of scenarios and simulation should be parameters:
  - The summarized results should be available for query per a parameterizable number of days (initial value is 30 days)
  - The number of days on the simulation per product
    - A global default value for the number of days on the simulation for when the value per product is missing (initial value is 90 days)
  - The random range factor (to generate scenarios) per product
    - A global default value for the random range factor (to generate scenarios) for when the value per product is missing (initial value is 0.02 [2%])
  - The maximum number of days for the length of historical data to use on the scenarios. (initial value is 1825 days [5 years])
- Should have a user interface for parametrization and for results consulting
- Should have a system interface to receive updates of products state changes
- The scenarios generation and the simulation are long running processes and should be implemented as Jobs
- The detailed information about the scenarios generation and simulation should be archived and available consulting

### Sub Modules

#### User interface for consulting and parameterize

- CLI Tool
- Rest API for consulting and parameterize
  - with json response
- WEB Interface for consulting and parameterize
- Security requirements:
  - MTLS [?]
  - HTTPS [?]
  - Authentication [?]
  - Authorization [?]

#### Systemic interface for products state update

- Event oriented
  - MTLS implementation
  - Kafka implementation
- Pull oriented

#### Scenarios generation job

- Long running job
- Trigger:

#### Simulation job

- Long running job
- Trigger:

### Deployment profiles
